# Claude Code가 “수정사항 제안”을 넘어 실제 수정까지 혼자 진행해버린 권한 과다 사고

> **작성자:** 박예준  
> **날짜:** 2026-02-28  
> **에피소드:** EP2

---

## Situation (상황)

- **문제 상황:**  
  Claude Code에게 “현 프로젝트에서 수정해야 할 거 알려달라”고 요청했더니, 수정사항 리스트를 스스로 만든 뒤 **사용자 확인 없이 실제 코드/파일 수정까지 진행**해버림.  
  (리뷰/제안이 목적이었는데, 도구 권한을 이용해 실행 단계로 넘어가 버린 케이스)

- **사용 도구:**  
  Claude Code (로컬 프로젝트 접근/수정 권한이 있는 에이전트 환경)

- **배경:**  
  최근 에이전트형 도구들은 파일 편집, 명령 실행, 외부 서비스 접근 등 **권한이 커진 만큼 “의도 vs 실행”이 쉽게 뒤섞임.**  
  비슷한 맥락으로, 오픈소스 에이전트(OpenClaw)가 이메일 정리 작업 중 사용자가 원치 않는 삭제를 진행해 문제가 됐다는 사례도 회자됨.
  > 2026년 2월, Meta 쪽 안전/얼라인먼트 직책의 연구자가 오픈소스 에이전트(OpenClaw)에 이메일 정리를 맡겼다가, 승인 없이 삭제가 진행되어 급히 기기에서 중단했다는 취지의 보도가 여럿 있었습니다.

## Task (과제)

- **목표:**  
  1) 에이전트가 “제안만” 하도록 통제하고,  
  2) 실제 수정은 **사람의 승인/리뷰**를 거치게 만들며,  
  3) 권한 과다로 인한 사고 가능성을 낮추는 **안전한 작업 프로세스**를 정리한다.

## Action (행동)

### 시행착오
- “프로젝트에서 수정해야 할 거 알려줘”처럼 **목표는 넓고, 금지/승인 조건은 없는** 프롬프트로 요청함.
- 도구 권한이 활성화된 상태에서, 에이전트가  
  1) 문제를 정의하고(자체 기준),  
  2) 해결책을 설계한 뒤,  
  3) **곧바로 파일을 수정**하는 흐름으로 진행함.
- 결과적으로 “내가 원한 건 리뷰/리스트”였는데, “에이전트는 실행까지 포함한 작업”으로 해석해버림.

**왜 잘 안 됐는지**
- 목표가 “조사/리스트업”인지 “수정까지”인지 경계가 모호했음.
- “파일 수정 금지”, “반드시 승인받기”, “diff만 제공” 같은 **가드레일 부재**
- 작업 전 `git status`/백업/브랜치 분리 없이 시작해 **되돌리기 비용**이 커질 뻔함.

### 해결 방법
아래를 “기본 작업 규칙(운영 룰)”로 고정했다.

1) **2단계 워크플로(Plan → Propose → Approvals → Apply)**
- 1단계: 읽기 전용 분석 + 수정 제안(리스트/근거/우선순위)
- 2단계: 내가 승인한 항목만, 내가 정한 범위에서 patch/diff 형태로 변경 제시  
  (실제 적용은 PR/커밋 단계에서 사람 승인)

2) **권한 최소화(Least Privilege)**
- 가능하면 에이전트에 “쓰기 권한”을 주지 않거나,
- 쓰기 권한이 필요해도 **폴더/파일 allowlist**, 브랜치 제한, “명령 실행 금지” 등으로 좁힘.

3) **승인 게이트(확인 없이는 실행 불가)**
- “파일 수정/삭제/이동/명령 실행은 매번 승인 요청”을 명시.
- 승인 단위를 “파일 단위”가 아니라 “변경 단위(패치/커밋 단위)”로 관리.

4) **실수 복구 장치**
- 작업 시작 전: `git status` clean 확인, 새 브랜치 생성, 중요 파일 백업
- 작업 종료 전: 테스트/린트는 “명령 제안만”, 실제 실행은 사람이 수행

5) **프롬프트 템플릿(예시)**  
- (읽기 전용 진단)
  - “이 프로젝트를 **읽기 전용으로** 분석하고, 수정이 필요한 항목을 **우선순위/근거/예상 영향**과 함께 목록으로만 작성해줘.  
     **파일 수정/명령 실행은 금지.**”
- (패치 제안)
  - “아래 3개 항목만 수정 패치를 제안해줘.  
     **실제 파일을 수정하지 말고** `diff` 형태로만 제공해.  
     각 diff는 1개 커밋 단위로 나눠서 설명해줘.”
- (실행 전 승인)
  - “다음 작업을 하기 전에는 반드시 ‘승인해도 될까요?’라고 묻고, 내가 ‘승인’이라고 답하기 전엔 어떤 변경도 하지 마.”

## Result (결과)

- 에이전트가 **리뷰/제안 역할**에 머물도록 통제되었고,
- 실제 변경은 내가 승인한 diff만 적용하는 흐름으로 바뀜.
- 동일 유형의 “혼자 수정해버리는” 사고 가능성이 크게 줄어듦.

## Learning (배움)

- **결정적 활용팁:**  
  **“목표는 좁게, 권한은 최소로, 실행은 승인 기반으로.”**
- **배운 것:**  
  - 에이전트형 도구는 “요청 = 실행 허가”로 해석할 수 있으니, **금지/승인/범위**를 프롬프트와 설정에서 먼저 고정해야 한다.  
  - “제안”과 “적용”은 반드시 분리하고, 변경은 **diff/PR/커밋** 같은 사람이 검토 가능한 형태로만 이동시키는 게 안전하다.  
  - 계정/메일/파일시스템처럼 파급이 큰 자원은 **샌드박스/테스트 데이터**로 먼저 검증한 뒤 실환경에 적용해야 한다.
